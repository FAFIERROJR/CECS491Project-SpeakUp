<ion-content>
    <ion-list no-lines [virtualScroll]="comments_obvs | async" [approxItemHeight]="'40px'" [virtualTrackBy]="trackByFn">
        <ion-item-sliding *virtualItem="let comment; let i=index">
            <ion-item *ngIf="is_instructor" (mouseenter)="toggleTimestamp(i)" (mouseleave)="toggleTimestamp(i); visible[i]=false">
                <ion-avatar item-start>
                    <img src="assets/icon/{{getUrl(comment.uid)}}.png">
                </ion-avatar>
                <h2>{{comment.username}}
                    <span class="subtextgroup" *ngIf="visible[i]">
                        <span class="points-style">
                            <span>{{comment.xp}}</span>
                            <span>pts</span>
                        </span>
                        <span class="timestamp">{{getTimestamp(comment.server_time)}}</span>
                        
                    </span>
                </h2>
                <p class="comment-content">{{comment.content}}</p>
            </ion-item>
            <ion-item-options side="left" *ngIf="is_instructor">
                <button id="DeleteComment" ion-button large clear (click)="deleteComment(comment.comment_id)">
                    <ion-icon ios="ios-trash" md="md-trash"></ion-icon>
                </button>
                <button ion-button large clear class="arrow-btn" (click)="vote(comment.comment_id, 1)">
                    <ion-icon ios="ios-arrow-up" md="md-arrow-up" [ngClass]="{'upvoted': (comment.vote_history? comment.vote_history[uid]?.value == 1: false)}"></ion-icon>
                </button>
                <button ion-button large clear disabled>{{comment.xp}} pts</button>
                <button ion-button large clear class="arrow-btn" (click)="vote(comment.comment_id, -1)">
                    <ion-icon ios="ios-arrow-down" md="md-arrow-down" [ngClass]="{'downvoted': (comment.vote_history? comment.vote_history[uid]?.value == -1: false)}"></ion-icon>
                </button>
            </ion-item-options>

            <ion-item *ngIf="!is_instructor" (mouseenter)="toggleTimestamp(i)" (mouseleave)="toggleTimestamp(i); visible[i]=false">
                <ion-avatar item-start>
                    <img src="assets/icon/{{getUrl(comment.uid)}}.png">
                </ion-avatar>
                <h2>{{getName(comment.uid)}}
                    <span class="subtextgroup" *ngIf="visible[i]">
                        <span class="points-style">
                            <span>{{comment.xp}}</span>
                            <span>pts</span>
                        </span>
                        <span class="timestamp">{{getTimestamp(comment.server_time)}}</span>
                        
                    </span>
                </h2>
                <p class="comment-content">{{comment.content}}</p>
            </ion-item>
            <ion-item-options side="left" *ngIf="!is_instructor">
                <button ion-button large clear class="arrow-btn" (click)="vote(comment.comment_id, 1)">
                    <ion-icon ios="ios-arrow-up" md="md-arrow-up"></ion-icon>
                </button>
                <button ion-button large clear disabled>{{comment.xp}} pts</button>
                <button ion-button large clear class="arrow-btn" (click)="vote(comment.comment_id, -1)" [ngClass]="{'upvoted': (comment.vote_history? comment.vote_history[uid]?.value == 1: false)}">
                    <ion-icon ios="ios-arrow-down" md="md-arrow-down" [ngClass]="{'downvoted': comment.vote_history? comment.vote_history[uid]?.value == -1: false}"></ion-icon>
                </button>
            </ion-item-options>
        </ion-item-sliding>
    </ion-list>
    <div #bottom id="bottom"></div>
</ion-content>